from PyQt5.QtWidgets import *

import sys
import sqlite3 as s3
from PyQt5 import uic


class W(QMainWindow):
    def __init__(self):
        super(W, self).__init__()
        uic.loadUi("main.ui", self)
        self.setWindowTitle('Another useless app to sort coffee')
        self.pushButton.clicked.connect(self.__coffee_func)

    def __coffee_func(self):
        """Решил для эксперимента сделать его приватным"""
        #try:

        with s3.connect('coffee.sqlite') as con:
            dict_sorts = {so[0]: so[1] for so in con.cursor().execute("SELECT * FROM sorts")}
            dict_categories = {ca[0]: ca[1] for ca in con.cursor().execute("SELECT * FROM categories")}

            res = list(map(lambda x: [x[0], dict_sorts[x[1]], dict_categories[x[2]], *x[3:]],
                      con.cursor().execute("SELECT * FROM coffee").fetchall()))

        self.tableWidget.setColumnCount(7)
        self.tableWidget.setRowCount(len(res))

        self.tableWidget.setHorizontalHeaderLabels([
            "ID", "сорт", "молотый/в зернах", "степень обжарки", "вкус", "цена", "объем"])

        for i, row in enumerate(res):
            for j, cvalue in enumerate(row):
                self.tableWidget.setItem(i, j, QTableWidgetItem(str(cvalue)))


if __name__ == "__main__":
    q = QApplication(sys.argv)
    b = W()
    b.show()
    sys.exit(q.exec())
